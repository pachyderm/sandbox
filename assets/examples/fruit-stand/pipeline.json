{
  "pipeline": {
    "name": "filter-{{.Repo.Name}}"
  },
  "transform": {
    "cmd": [ "sh" ],
    "stdin": [
        "grep apple  /pfs/{{.Repo.Name}}/sales >/pfs/out/apple",
        "grep banana /pfs/{{.Repo.Name}}/sales >/pfs/out/banana",
        "grep orange /pfs/{{.Repo.Name}}/sales >/pfs/out/orange"
    ]
  },
  "shards": "1",
  "inputs": [
    {
      "repo": {
        "name": "{{.Repo.Name}}"
      }
    }
  ]
}
{
  "pipeline": {
    "name": "sum-{{.Repo.Name}}"
  },
  "transform": {
    "cmd": [ "sh" ],
    "stdin": [
        "cut -f 2 /pfs/filter/apple | awk '{s+=$1} END {print s}' >/pfs/out/apple",
        "cut -f 2 /pfs/filter/banana | awk '{s+=$1} END {print s}' >/pfs/out/banana",
        "cut -f 2 /pfs/filter/orange | awk '{s+=$1} END {print s}' >/pfs/out/orange"
    ]
  },
  "shards": "1",
  "inputs": [
    {
      "repo": {
        "name": "filter-{{.Repo.Name}}"
      },
      "reduce": true
    }
  ]
}
